#!/usr/bin/python
# -*- coding: utf-8 -*-

#Oracle에 없는 mdsid 를 찾는 코드
import time
import datetime
import cx_Oracle
import requests
import json


# update 15 minutes one TSDB
def updateMINONE(in_sttime, in_entime, in_mdsid):
        starttime = in_sttime
        endtime = in_entime
        mdsid = in_mdsid

        sql_tmp = "select ELE.LP_TIME, ELE.VALUE_00, ELE.VALUE_15, ELE.VALUE_30, ELE.VALUE_45, ECU.NAME, ECO.LOCATION, ECO.SIC, ELE.MDS_ID, ELE.DEVICE_SERIAL, ECU.CUSTOMERNO, ELE.CHANNEL from EMNV_LP_EM_VIEW  ELE join EMNV_CONTRACT_VIEW ECO on ELE.MDS_ID = ECO.MDS_ID join EMNV_CUSTOMER_VIEW ECU on ECO.CUSTOMERNO = ECU.CUSTOMERNO where (ELE.CHANNEL=1) and (ELE.LP_TIME between '%s' and '%s') and (ELE.MDS_ID='%s') order by ELE.MDS_ID ASC, ELE.LP_TIME ASC" %(starttime, endtime, mdsid)

        cur.execute(sql_tmp)
        check=0
        for result in cur:
            check=1
            break

        return check

# main function
if __name__ == "__main__":
        count_n=0
        sttime = "2016110100"
        entime = "2016111523"

        #체크할 MDSID 리스트들
        black_list =['00-250071531', '00-250130341', '00-250130340', '00-250130343', '00-250130342', '00-250130345', '00-250130344', '00-250068220', '00-250068221', '00-250068224', '00-250068225', '00-250068226', '00-250068227', '00-250068229', '00-250060000', '00-250060001', '00-250060002', '00-250130323', '00-250130338', '00-250130339', '00-250130335', '00-250130331', '00-250071407', '00-250071405', '00-250071403', '00-250071153', '00-250068134', '00-250068135', '00-250068136', '00-250068137', '00-250071408', '00-250071409', '00-450083448', '00-450083445', '00-450083446', '00-250071140', '00-250071121', '00-250068148', '00-250071122', '00-250071126', '00-250068141', '00-250068140', '00-250068143', '00-250068145', '00-250068144', '00-250068146', '00-250071308', '00-250071659', '00-250059992', '00-250059996', '00-250059997', '00-250059998', '00-250059999', '00-250071495', '00-250102710', '00-250071394', '00-250071392', '00-250059823', '00-250071012', '00-250071575', '00-250070999', '00-250130385', '00-250130384', '00-250070994', '00-250070993', '00-250130380', '00-250071372', '00-250059861', '00-250059798', '00-450086528', '00-250059768', '00-250059765', '00-250071681', '00-250059766', '00-250059761', '00-250071359', '00-250130374', '00-250130375', '00-250130376', '00-250130377', '00-250130378', '00-250130379', '00-250068170', '00-250068171', '00-250068172', '00-250068173', '00-250068175', '00-250068176', '00-250068177', '00-250068178', '00-250068179', '00-250068189', '00-250068188', '00-250068185', '00-250068180', '00-250068182', '00-250071025', '00-250071026', '00-250071459', '00-250071451', '00-250071029', '00-250071453', '00-250071183', '00-250071182', '00-250071181', '00-250071186', '00-250071185', '00-250071184', '00-250071189', '00-250071188', '00-250071052', '00-250071055', '00-250071057', '00-250068071', '00-360000245', '00-360000241', '00-250071330', '00-250059948', '00-250071624', '00-250071625', '00-250059945', '00-250059947', '00-251004742', '00-250071525', '00-250071527', '00-250071521', '00-250071520', '00-250059835', '00-250059720', '00-250059836', '00-250059724', '00-250059839', '00-250068232', '00-250068231', '00-250068230', '00-450086517', '00-450086512', '00-250059754', '00-250059751', '00-250130327', '00-250130326', '00-250130325', '00-250130324', '00-250059758', '00-250130321', '00-250130320', '00-250071144', '00-250071414', '00-250071417', '00-250071416', '00-250071028', '00-250052077', '00-250059819', '00-250071667', '00-250059989', '00-250071661', '00-250071700', '00-250059982', '00-250071464', '00-250071465', '00-250071467', '00-250071468', '00-250071469', '00-250071151', '00-250102649', '00-250102648', '00-250102644', '00-250130307', '00-250071068', '00-250070992', '00-250071387', '00-250071061', '00-250071065', '00-250071066', '00-250059816', '00-250071005', '00-250070991', '00-250071369', '00-250071368', '00-250059871', '00-250059873', '00-250071364', '00-250059875', '00-250059874', '00-250059975', '00-250059976', '00-250059818', '00-250059703', '00-250071696', '00-250068193', '00-250059783', '00-250059814', '00-250059784', '00-250059813', '00-250059789', '00-250059812', '00-250071518', '00-250059705', '00-250071510', '00-250059718', '00-250059719', '00-250059807', '00-460003531', '00-250059717', '00-250130363', '00-250130362', '00-250130361', '00-250130367', '00-250130365', '00-250130369', '00-250130368', '00-250068162', '00-250068161', '00-250068160', '00-250068167', '00-250068166', '00-250068165', '00-250068164', '00-250068169', '00-250071059', '00-251008570', '00-250068219', '00-250059849', '00-250071428', '00-250071032', '00-250071031', '00-250071030', '00-250071424', '00-250071039', '00-250071427', '00-450083463', '00-250068149', '00-250071109', '00-250071104', '00-250071632', '00-250071088', '00-250071089', '00-250071086', '00-250071087', '00-250071085', '00-250059949', '00-250102776', '00-250071336', '00-250071550', '00-250071557', '00-250071558', '00-250071559', '00-250059841', '00-250059928', '00-250059848', '00-250059926', '00-250059925', '00-250059921', '00-250060022', '00-251000081', '00-450086506', '00-450086503', '00-250130318', '00-250130312', '00-250130313', '00-250130310', '00-250130316', '00-250130317', '00-250130314', '00-250130315', '00-250071172', '00-250071170', '00-250071171', '00-250071176', '00-250071175', '00-250059780', '00-250071493', '00-250071373', '00-360000177', '00-250068208', '00-250068207', '00-250068202', '00-250068203', '00-250068201', '00-360000216', '00-250071677', '00-250071679', '00-250071678', '00-360000218', '00-250071442', '00-250071440', '00-250071073', '00-250071072', '00-250071071', '00-250071074', '00-250059887', '00-250071217', '00-250130381', '00-250071218', '00-250071356', '00-250071357', '00-250071355', '00-250059961', '00-250059960', '00-250059965', '00-250059964', '00-250059968', '00-250071622', '00-250130383', '00-250071509', '00-250071507', '00-250071504', '00-250059709', '00-250059708', '00-250130358', '00-250130359', '00-250130356', '00-250130357', '00-250059701', '00-250130355', '00-250059707', '00-250071692', '00-250059811', '00-250059704', '00-250059801', '00-250059803', '00-250071699', '00-250071438', '00-250071004', '00-250059834', '00-250071432', '00-250071434', '00-450083458', '00-250068158', '00-250068159', '00-250068157', '00-250068154', '00-250068153', '00-250068150', '00-250071319', '00-250071640', '00-250071312', '00-250071310', '00-250071311', '00-250071097', '00-250071096', '00-250071091', '00-250071090', '00-250070996', '00-250071099', '00-250071098', '00-250071481', '00-250052085', '00-250059715', '00-250071370', '00-250071371', '00-250059860', '00-250130382', '00-250071694', '00-250007125', '00-250071540', '00-250071547', '00-250071549', '00-250071548', '00-250059853', '00-250059852', '00-250059851', '00-250059856', '00-250059855', '00-250059854', '00-250059859', '00-250059858', '00-250059916', '00-250059917', '00-250059915', '00-250071138', '00-250059706', '00-250068139', '00-250059770', '00-250130306', '00-250059777', '00-250059774', '00-250059775', '00-250059778', '00-250130309', '00-250130308', '00-250071647', '00-251008614', '00-250068192', '00-250068218', '00-250068196', '00-250068197', '00-250068210', '00-250068198', '00-250068212', '00-250068215', '00-250068217', '00-250071190', '00-250071191', '00-250071192', '00-250071449', '00-450083404', '00-450083403', '00-250102620', '00-250071168', '00-250071165', '00-250071167', '00-250071166', '00-250071582', '00-250071581', '00-250071612', '00-250059959', '00-250059956', '00-250059957', '00-250059954', '00-250071290', '00-360000183', '00-360000182', '00-360000202', '00-360000203', '00-360000187', '00-360000205', '00-360000185', '00-360000184', '00-360000244', '00-360000209', '00-360000260', '00-360000247', '00-360000181', '00-360000242', '00-360000243', '00-360000194', '00-450083462', '00-450083461', '00-360000132', '00-360000093', '00-450083465', '00-360000238', '00-450083522', '00-450083469', '00-360000258', '00-360000156', '00-450083524', '00-360000172', '00-360000155', '00-360000170', '00-360000157', '00-360000152', '00-360000175', '00-360000231', '00-360000233', '00-360000232', '00-360000235', '00-360000234', '00-360000237', '00-360000236', '00-360000191', '00-360000193', '00-360000217', '00-360000228', '00-360000259', '00-360000197', '00-360000199', '00-360000153', '00-360000252', '00-360000250', '00-360000264', '00-450083467', '00-450083466', '00-450083470', '00-360000166', '00-450083419', '00-360000127', '00-360000281', '00-360000262', '00-360000283', '00-360000107', '00-360000160', '00-360000159', '00-360000196', '00-360000004', '00-450083417', '00-450086604', '00-450083464', '00-360000189', '00-360000225', '00-360000222', '00-360000282', '00-450086602']


        con = cx_Oracle.connect('keti_user/keti1357!#@125.141.144.149/aimir')
        cur = con.cursor()
        count=0
        real_no_oracle=[]
        for mds_id in black_list:

            count_n = updateMINONE(sttime, entime, mds_id)
            if count_n==0:
                count=count+1
                real_no_oracle.append(mds_id)

        print count,len(real_no_oracle)
        print real_no_oracle

        cur.close()
        con.close()


